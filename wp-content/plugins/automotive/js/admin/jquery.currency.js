//  This file is part of the jQuery formatCurrency Plugin.
//
//    The jQuery formatCurrency Plugin is free software: you can redistribute it
//    and/or modify it under the terms of the GNU General Public License as published 
//    by the Free Software Foundation, either version 3 of the License, or
//    (at your option) any later version.

//    The jQuery formatCurrency Plugin is distributed in the hope that it will
//    be useful, but WITHOUT ANY WARRANTY; without even the implied warranty 
//    of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//    GNU General Public License for more details.
//
//    You should have received a copy of the GNU General Public License along with 
//    the jQuery formatCurrency Plugin.  If not, see <http://www.gnu.org/licenses/>.

(function(e){function t(t){var n=e.formatCurrency.regions[t];if(n){return n}else{if(/(\w+)-(\w+)/g.test(t)){var r=t.replace(/(\w+)-(\w+)/g,"$1");return e.formatCurrency.regions[r]}}return null}function n(e){switch(e.toLowerCase()){case"int":return"Int";case"float":return"Float";default:throw"invalid parseType"}}function r(e){if(e.symbol===""){return new RegExp("[^\\d"+e.decimalSymbol+"-]","g")}else{var t=e.symbol.replace("$","\\$").replace(".","\\.");return new RegExp(t+"|[^\\d"+e.decimalSymbol+"-]","g")}}e.formatCurrency={};e.formatCurrency.regions=[];e.formatCurrency.regions[""]={symbol:"$",positiveFormat:"%s%n",negativeFormat:"(%s%n)",decimalSymbol:".",digitGroupSymbol:",",groupDigits:true};e.fn.formatCurrency=function(n,i){if(arguments.length==1&&typeof n!=="string"){i=n;n=false}var s={name:"formatCurrency",colorize:false,region:"",global:true,roundToDecimalPlace:2,eventOnDecimalsEntered:false};s=e.extend(s,e.formatCurrency.regions[""]);i=e.extend(s,i);if(i.region.length>0){i=e.extend(i,t(i.region))}i.regex=r(i);return this.each(function(){$this=e(this);var t="0";t=$this[$this.is("input, select, textarea")?"val":"html"]();if(t.search("\\(")>=0){t="-"+t}if(t===""||t==="-"&&i.roundToDecimalPlace===-1){return}if(isNaN(t)){t=t.replace(i.regex,"");if(t===""||t==="-"&&i.roundToDecimalPlace===-1){return}if(i.decimalSymbol!="."){t=t.replace(i.decimalSymbol,".")}if(isNaN(t)){t="0"}}var r=String(t).split(".");var s=t==Math.abs(t);var o=r.length>1;var u=o?r[1].toString():"0";var a=u;t=Math.abs(r[0]);t=isNaN(t)?0:t;if(i.roundToDecimalPlace>=0){u=parseFloat("1."+u);u=u.toFixed(i.roundToDecimalPlace);if(u.substring(0,1)=="2"){t=Number(t)+1}u=u.substring(2)}t=String(t);if(i.groupDigits){for(var f=0;f<Math.floor((t.length-(1+f))/3);f++){t=t.substring(0,t.length-(4*f+3))+i.digitGroupSymbol+t.substring(t.length-(4*f+3))}}if(o&&i.roundToDecimalPlace==-1||i.roundToDecimalPlace>0){t+=i.decimalSymbol+u}var l=s?i.positiveFormat:i.negativeFormat;var c=l.replace(/%s/g,i.symbol);c=c.replace(/%n/g,t);var h=e([]);if(!n){h=$this}else{h=e(n)}h[h.is("input, select, textarea")?"val":"html"](c);if(o&&i.eventOnDecimalsEntered&&a.length>i.roundToDecimalPlace){h.trigger("decimalsEntered",a)}if(i.colorize){h.css("color",s?"black":"red")}})};e.fn.toNumber=function(n){var i=e.extend({name:"toNumber",region:"",global:true},e.formatCurrency.regions[""]);n=jQuery.extend(i,n);if(n.region.length>0){n=e.extend(n,t(n.region))}n.regex=r(n);return this.each(function(){var t=e(this).is("input, select, textarea")?"val":"html";e(this)[t](e(this)[t]().replace("(","(-").replace(n.regex,""))})};e.fn.asNumber=function(i){var s=e.extend({name:"asNumber",region:"",parse:true,parseType:"Float",global:true},e.formatCurrency.regions[""]);i=jQuery.extend(s,i);if(i.region.length>0){i=e.extend(i,t(i.region))}i.regex=r(i);i.parseType=n(i.parseType);var o=e(this).is("input, select, textarea")?"val":"html";var u=e(this)[o]();u=u?u:"";u=u.replace("(","(-");u=u.replace(i.regex,"");if(!i.parse){return u}if(u.length==0){u="0"}if(i.decimalSymbol!="."){u=u.replace(i.decimalSymbol,".")}return window["parse"+i.parseType](u)}})(jQuery)