// jquery.tweet.js - See http://tweet.seaofclouds.com/ or https://github.com/seaofclouds/tweet for more info
// Copyright (c) 2008-2012 Todd Matthews & Steve Purcell
// Modified by Stan Scates for https://github.com/StanScates/Tweet.js-Mod

!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){t.fn.tweet=function(e){function r(t,e){if("string"==typeof t){var r=t;for(var a in e){var n=e[a];r=r.replace(new RegExp("{"+a+"}","g"),null===n?"":n)}return r}return t(e)}function a(e,r){return function(){var a=[];return this.each(function(){a.push(this.replace(e,r))}),t(a)}}function n(t){return t.replace(/</g,"&lt;").replace(/>/g,"^&gt;")}function s(t,e){return t.replace(w,function(t){for(var r=/^[a-z]+:/i.test(t)?t:"http://"+t,a=t,s=0;s<e.length;++s){var i=e[s];if(i.url==r&&i.expanded_url){r=i.expanded_url,a=i.display_url;break}}return'<a href="'+n(r)+'">'+n(a)+"</a>"})}function i(t){return Date.parse(t.replace(/^([a-z]{3})( [a-z]{3} \d\d?)(.*)( \d{4})$/i,"$1,$2$4$3"))}function u(t){var e=arguments.length>1?arguments[1]:new Date,r=parseInt((e.getTime()-t)/1e3,10),a="";return a=1>r?"just now":60>r?r+" seconds ago":120>r?"about a minute ago":2700>r?"about "+parseInt(r/60,10).toString()+" minutes ago":7200>r?"about an hour ago":86400>r?"about "+parseInt(r/3600,10).toString()+" hours ago":172800>r?"about a day ago":"about "+parseInt(r/86400,10).toString()+" days ago"}function o(t){return t.match(/^(@([A-Za-z0-9-_]+)) .*/i)?p.auto_join_text_reply:t.match(w)?p.auto_join_text_url:t.match(/^((\w+ed)|just) .*/im)?p.auto_join_text_ed:t.match(/^(\w*ing) .*/i)?p.auto_join_text_ing:p.auto_join_text_default}function l(){var e=(p.modpath,null===p.fetch?p.count:p.fetch),r={include_entities:1};if(p.list)return{host:p.twitter_api_url,url:"/1.1/lists/statuses.json",parameters:t.extend({},r,{list_id:p.list_id,slug:p.list,owner_screen_name:p.username,page:p.page,count:e,include_rts:p.retweets?1:0})};if(p.favorites)return{host:p.twitter_api_url,url:"/1.1/favorites/list.json",parameters:t.extend({},r,{list_id:p.list_id,screen_name:p.username,page:p.page,count:e})};if(null===p.query&&1===p.username.length)return{host:p.twitter_api_url,url:"/1.1/statuses/user_timeline.json",parameters:t.extend({},r,{screen_name:p.username,page:p.page,count:e,include_rts:p.retweets?1:0})};var a=p.query||"from:"+p.username.join(" OR from:");return{host:p.twitter_search_url,url:"/search.json",parameters:t.extend({},r,{page:p.page,q:a,rpp:e})}}function _(t,e){return e?"user"in t?t.user.profile_image_url_https:_(t,!1).replace(/^http:\/\/[a-z0-9]{1,3}\.twimg\.com\//,"https://s3.amazonaws.com/twitter_production/"):t.profile_image_url||t.user.profile_image_url}function c(e){var a={};return a.item=e,a.source=e.source,a.name=e.from_user_name||e.user.name,a.screen_name=e.from_user||e.user.screen_name,a.avatar_size=p.avatar_size,a.avatar_url=_(e,"https:"===document.location.protocol),a.retweet="undefined"!=typeof e.retweeted_status,a.tweet_time=i(e.created_at),a.join_text="auto"==p.join_text?o(e.text):p.join_text,a.tweet_id=e.id_str,a.twitter_base="http://"+p.twitter_url+"/",a.user_url=a.twitter_base+a.screen_name,a.tweet_url=a.user_url+"/status/"+a.tweet_id,a.reply_url=a.twitter_base+"intent/tweet?in_reply_to="+a.tweet_id,a.retweet_url=a.twitter_base+"intent/retweet?tweet_id="+a.tweet_id,a.favorite_url=a.twitter_base+"intent/favorite?tweet_id="+a.tweet_id,a.retweeted_screen_name=a.retweet&&e.retweeted_status.user.screen_name,a.tweet_relative_time=u(a.tweet_time),a.entities=e.entities?(e.entities.urls||[]).concat(e.entities.media||[]):[],a.tweet_raw_text=a.retweet?"RT @"+a.retweeted_screen_name+" "+e.retweeted_status.text:e.text,a.tweet_text=t([s(a.tweet_raw_text,a.entities)]).linkUser().linkHash()[0],a.tweet_text_fancy=t([a.tweet_text]).makeHeart()[0],a.user=r('<a class="ts-tweet-user-name" href="{user_url}">{screen_name}</a>',a),a.join=p.join_text?r(' <span class="tweet_join">{join_text}</span> ',a):" ",a.avatar=a.avatar_size?r('<a class="ts-tweet-profile-image" href="{user_url}"><img src="{avatar_url}" height="{avatar_size}" width="{avatar_size}" alt="{screen_name}\'s avatar" title="{screen_name}\'s avatar" border="0"/></a>',a):"",a.text=r('<span class="ts-tweet-text">{tweet_text_fancy}',a),a.time=r("",a),a.reply_action=r('<span class="ts-tweet-action-reply"><a class="tweet_reply" href="{reply_url}">reply</a></span>',a),a.retweet_action=r('<span class="ts-tweet-action-retweet"><a class="tweet_retweet" href="{retweet_url}">retweet</a></span>',a),a.favorite_action=r('<span class="ts-tweet-action-favorite"><a class="tweet_favorite" href="{favorite_url}">favorite</a></span>',a),a}var p=t.extend({modpath:"/twitter/",username:null,list_id:null,list:null,favorites:!1,query:null,avatar_size:null,count:3,fetch:null,page:1,retweets:!0,intro_text:null,outro_text:null,join_text:null,auto_join_text_default:"i said,",auto_join_text_ed:"i",auto_join_text_ing:"i am",auto_join_text_reply:"i replied to",auto_join_text_url:"i was looking at",loading_text:null,refresh_interval:null,twitter_url:"twitter.com",twitter_api_url:"api.twitter.com",twitter_search_url:"search.twitter.com",template:"{avatar}{time}{join}{text}",comparator:function(t,e){return e.tweet_time-t.tweet_time},filter:function(){return!0}},e),w=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;return t.extend({tweet:{t:r}}),t.fn.extend({linkUser:a(/(^|[\W])@(\w+)/gi,'$1<span class="at">@</span><a href="http://'+p.twitter_url+'/$2">$2</a>'),linkHash:a(/(?:^| )[\#]+([\w\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0600-\u06ff]+)/gi,' <a href="http://'+p.twitter_search_url+"/search?q=&tag=$1&lang=all"+(p.username&&1==p.username.length&&!p.list?"&from="+p.username.join("%2BOR%2B"):"")+'" class="tweet_hashtag">#$1</a>'),makeHeart:a(/(&lt;)+[3]/gi,"<tt class='heart'>&#x2665;</tt>")}),this.each(function(e,a){var n=t('<ul class="ts-tweet-list">'),s='<p class="tweet_intro">'+p.intro_text+"</p>",i='<p class="tweet_outro">'+p.outro_text+"</p>",u=t('<p class="loading">'+p.loading_text+"</p>");p.username&&"string"==typeof p.username&&(p.username=[p.username]),t(a).unbind("tweet:load").bind("tweet:load",function(){p.loading_text&&t(a).empty().append(u),t.ajax({dataType:"json",type:"post",async:!0,url:p.modpath||"/twitter/",data:{request:l()},success:function(e){e.message;var u=e.response;t(a).empty().append(n),p.intro_text&&n.before(s),n.empty(),resp=void 0!==u.statuses?u.statuses:void 0!==u.results?u.results:u;var o=t.map(resp,c);o=t.grep(o,p.filter).sort(p.comparator).slice(0,p.count),n.append(t.map(o,function(t){return"<li class='ts-tweet-list-item'>"+r(p.template,t)+"</li>"}).join("")).children("li:first").addClass("tweet_first").end().children("li:odd").addClass("tweet_even").end().children("li:even").addClass("tweet_odd"),p.outro_text&&n.after(i),t(a).trigger("loaded").trigger(o?"empty":"full"),p.refresh_interval&&window.setTimeout(function(){t(a).trigger("tweet:load")},1e3*p.refresh_interval)}})}).trigger("tweet:load")})}});